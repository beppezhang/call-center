<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>外呼管理—外呼记录</title>
    <link rel="stylesheet" href="css/common/reset.css">
    <link rel="stylesheet" href="css/elementui.css">
    <link rel="stylesheet" href="css/common/nav_header.css" />
    <style>
        /* #box {
            padding: 150px 0 0;
            width: 1800px;
            margin: 0 auto;
            background-size: contain;
            position: relative;
        } */

        .clearfix:after {
            content: '';
            font-size: 0;
            display: block;
            height: 0;
            overflow: hidden;
        }

        [v-cloak] {
            display: none
        }

        .el-form--inline .el-form-item.item-mr {
            margin-right: 20px;
            margin-bottom: 0;
        }
        .hangupPosition .el-form-item__label{
            float: left;
            padding: 11px 0;
        }
        .hangupPosition .el-form-item__content{
            float: left;
            width: 400px;
        }
        #adviser{
            position: absolute;
            top:100px;
            right: 30px;
        }
        #box .quit{
            color: red;
            cursor: pointer;
        }
        .toolbar {
            background: #f2f2f2;
            padding: 10px;
            margin: 10px 0px;
        }
        .comSty{width: inherit;}
        .search{margin: 10px 200px 10px 0;}
        .search>.el-select,.search>.el-input{margin: 0 10px 10px 0;width: 250px;}
        .comIcon{width: 20px;}
        .virtual_number{font-size: 20px;margin-bottom: 20px;}
        .virtual_number span{color: blue;}
        .el-table .cell,.el-table th>div{padding-left:5px;padding-right: 5px; }
        #app .el-dialog--small{width: 1300px;}
        .bind .el-button.el-button--small{margin-left: 0;margin-top: 10px;}
        .lookaddedit .el-form-item{width: 300px;}
        .lookaddedit .el-form-item .el-form-item__label{width: 80px;}
        .lookaddedit .el-form-item .el-form-item__content .el-input,.lookaddedit .el-form-item .el-form-item__content .el-select,.lookaddedit .el-form-item .el-form-item__content .el-textarea,.lookaddedit .el-form-item .el-form-item__content .el-radio-group{width: 220px;}
        .lookaddedit .el-form-item .el-form-item__content .el-radio-group .el-radio{width: 60px;margin-left: 20px;}
        #app .cancal{margin-left:0;margin-top: 5px; }
    </style>
    <script src="js/vue.js"></script>
    <script src="js/elementui.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="js/common/cookie.js"></script>
    <script src="js/common/header.js"></script>
    <script src="js/common/format.js"></script>
    <script src="js/common/getdictionary.js"></script>
    <script src="js/common/nav.js"></script>
</head>
<body>
<div id="app" v-cloak>
    <el-row class="container">
        <header-list></header-list>
        <el-col :span="24" class="main">
            <!-- 侧边栏 -->
            <nav-list index="1-2"></nav-list>
            <section class="content-container">
                <div class="grid-content bg-purple-light">
                    <!-- 面包屑 -->
                    <el-col :span="24" class="breadcrumb-container">
                        <el-breadcrumb separator="/">
                            <el-breadcrumb-item>首页</el-breadcrumb-item>
                            <el-breadcrumb-item>外呼管理</el-breadcrumb-item>
                            <el-breadcrumb-item>外呼记录</el-breadcrumb-item>
                        </el-breadcrumb>
                    </el-col>
                    <el-col :span="24" class="content-wrapper" v-loading="fullscreenLoading"  element-loading-text="拼命加载中">
                        <!-- 主体内容 -->
                            <!--以下是查询所需字段开始-->
                            <div class="search">
                                <!-- 下拉选择清单号 -->
                                <el-select v-model="batchData" placeholder="请选择批次" @change="changeOption">
                                    <el-option v-for="item in options" :label="item" :value="item">
                                    </el-option>
                                </el-select>
                                <!--客户姓名-->
                                <el-input v-model="customername" placeholder="请输入姓名" class="comSty"></el-input>
                                <!-- 客服昵称 -->
                                <el-input v-model="serverName" placeholder="客服昵称" class="comSty"></el-input>
                                <!--呼叫结果-->
                                <el-select v-model="callresult" clearable placeholder="请选择呼叫结果">
                                    <el-option v-for="item in callResult" :label="item.name" :value="item.code"></el-option>
                                </el-select>
                                <!-- 重复次数 -->
                                <el-input v-model="repeatTimes" placeholder="拨打次数" class="comSty"></el-input>
                                <!-- 跟进天数 -->
                                <el-input v-model="followday" placeholder="跟进天数" class="comSty"></el-input>
                                <!-- 通话时间 -->
                                <el-input v-model="calltime" placeholder="通话时长（秒）" class="comSty"></el-input>
                                <!-- 开始时间 -->
                                <el-date-picker v-model="begintime" type="datetime" placeholder="选择开始通话时间"></el-date-picker>
                                <!-- 结束时间 -->
                                <el-date-picker v-model="endtime" type="datetime" placeholder="选择结束通话时间"></el-date-picker>
                                <el-button type="primary" icon="search" @click="searchGetData">查询</el-button>
                                <el-button type="primary" icon="upload2" @click="exportData">导出</el-button>
                            </div>
                            <!--以上是查询所需字段结束-->
                            <!--列表-->
                            <el-table :data="batchTableData" border highlight-current-row style="width: 100%">
                                <el-table-column align="center" prop="id" label="客户ID"></el-table-column>
                                <el-table-column align="center" width="70" prop="name" label="姓名"></el-table-column>
                                <el-table-column align="center" width="50" prop="sex" label="性别" :formatter="changeSex"></el-table-column>
                                <el-table-column align="center" prop="customerTag" label="标签"></el-table-column>
                                <el-table-column width="110" align="center" prop="mobile" label="手机"></el-table-column>
                                <el-table-column align="center" prop="lastCustomerServerNickName" label="客服昵称"></el-table-column>
                                <el-table-column align="center" prop="isRepeat" label="标签重复" :formatter="changeRepeat"></el-table-column>
                                <el-table-column align="center" width="70" prop="callResult" label="呼叫结果" :formatter="changecallResult"></el-table-column>
                                <el-table-column align="center" prop="hangUpPosition" :formatter="changeHangUpPosition" label="挂断位置"></el-table-column>
                                <el-table-column align="center" prop="startCallTime" label="开始时间"  :formatter="changeStartCallTime"></el-table-column>
                                <el-table-column align="center" prop="endCallTime" label="结束时间"  :formatter="changeEndCallTime"></el-table-column>
                                <el-table-column align="center" prop="dialTime" label="拨打次数"></el-table-column>
                                <el-table-column align="center" prop="remark" label="备注"></el-table-column>
                                <el-table-column align="center" prop="lastOperateTime" label="操作时间" :formatter="changeLastTime"></el-table-column>
                                <el-table-column align="center" width="70" prop="followStatus" :formatter="changeIsFollow" label="跟进状态"></el-table-column>
                                <el-table-column align="center" prop="followDay" label="跟进天数"></el-table-column>

                                <el-table-column align="center" prop="virtualMobile" label="虚拟号码"></el-table-column>
                                <el-table-column align="center" class="bind" label="绑定与解绑">
                                    <template scope="scope">
                                        <el-button size="small" @click="handleAdd(scope.$index, scope.row)">绑定</el-button>
                                        <el-button class="cancal" size="small" @click="unbind()">解绑</el-button>
                                    </template>
                                </el-table-column>
                                <el-table-column align="center" label="操作">
                                    <template scope="scope">
                                        <i class="el-icon-plus comIcon" @click="handleAdd(scope.$index, scope.row)" title="新增"></i>
                                        <i class="el-icon-edit comIcon" @click="handleEdit(scope.$index, scope.row)" title="编辑"></i>
                                        <i class="el-icon-document comIcon" @click="checkAll(scope.$index, scope.row)" title="历史记录"></i>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <!--下分页-->
                            <el-col :span="24" class="toolbar" v-show="this.totalPage">
                                <div class="block">
                                    <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="currentPage" :page-size="pageSize" layout="total,sizes,prev, pager, next, jumper" :total="totalPage" style="float:right;" :page-sizes="[2, 4, 8, 10]">
                                    </el-pagination>
                                </div>
                            </el-col>
                            
                            <!--查询与编辑外呼页面-->
                            <el-dialog title="查询与编辑外呼记录" v-model="dialogEditForm" :close-on-click-modal="false" v-cloak class="lookaddedit">
                                <el-form :model="editForm" class="el-form el-form--inline">
                                    <el-form-item label="客户ID">
                                        <el-input v-model="editForm.customerTagId" auto-complete="off" :disabled="true"></el-input>
                                    </el-form-item>
                                    <el-form-item label="客户标签" v-if="flag">
                                        <el-input v-model="editForm.customerTag" auto-complete="off" :disabled="true"></el-input>
                                    </el-form-item>
                                    <el-form-item label="操作日期">
                                        <el-input v-model="editForm.lastOperateTime" auto-complete="off" :disabled="true"></el-input>
                                    </el-form-item>
                                    <el-form-item v-if="flag" label="拨打次数">
                                        <el-input v-model="editForm.dialTime" auto-complete="off" :disabled="true"></el-input>
                                    </el-form-item>
                                    <el-form-item label="客服昵称">
                                        <el-input v-model="editForm.lastCustomerServerNickName" auto-complete="off" :disabled="true"></el-input>
                                    </el-form-item>
                                    <el-form-item label="客户姓名">
                                        <el-input v-model="editForm.name" auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item label="手机号码">
                                        <el-input v-model="editForm.mobile" auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item label="客户性别">
                                        <el-radio-group v-model="editForm.sex">
                                            <el-radio :label="1">男</el-radio>
                                            <el-radio :label="0">女</el-radio>
                                        </el-radio-group>
                                    </el-form-item><!-- 
                                    <el-form-item label="标签重复" v-if="flag">
                                        <el-radio-group v-model="editForm.isRepeate">
                                            <el-radio :label="0">是</el-radio>
                                            <el-radio :label="1">否</el-radio>
                                        </el-radio-group>
                                    </el-form-item> -->
                                    <el-form-item label="呼叫结果">
                                        <el-select v-model="editForm.callResult" clearable>
                                            <el-option v-for="item in callResult" :label="item.name" :value="item.code"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="挂断位置">
                                        <el-select v-model="editForm.hangUpPosition" placeholder="请选择挂断位置" clearable>
                                            <el-option v-for="item in hangup" :label="item.name" :value="item.code"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="开始时间">
                                        <el-date-picker v-model="editForm.startCallTime" type="datetime" placeholder="选择开始通话时间">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="结束时间">
                                        <el-date-picker v-model="editForm.endCallTime" type="datetime" placeholder="选择结束通话时间">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="备注">
                                        <el-input type="textarea" v-model="editForm.remark"></el-input>
                                    </el-form-item>
                                    <el-form-item label="跟踪状态">
                                        <el-select v-model="editForm.followStatus" @change="changeFollowstatus" clearable>
                                            <el-option v-for="item in followStatu" :label="item.name" :value="item.code"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item v-show="editForm.followStatus==0" label="跟踪日期">
                                        <el-date-picker v-model="editForm.followDate" type="datetime" placeholder="选择跟踪日期" :picker-options="pickerOptions">
                                        </el-date-picker>
                                    </el-form-item>
                                </el-form>
                                <div slot="footer" class="dialog-footer">
                                    <el-button @click="dialogEditForm = false">取 消</el-button>
                                    <el-button type="primary" @click="onEditSubmit" :loading="editLoading">确 定</el-button>
                                </div>
                            </el-dialog>

                            <!-- 新增页面 -->
                            <el-dialog title="新增外呼记录" v-model="dialogAddForm" :close-on-click-modal="false" v-cloak class="lookaddedit">
                                <div class="virtual_number">当前虚拟号码：<span>185****1245</span></div>
                                <el-form :model="addForm" class="el-form el-form--inline">
                                    <el-form-item label="客户姓名">
                                        <el-input v-model="addForm.name" auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item label="手机号码">
                                        <el-input v-model="addForm.mobile" auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item label="呼叫结果">
                                        <el-select v-model="addForm.callResult" clearable>
                                            <el-option v-for="item in callResult" :label="item.name" :value="item.code"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="客户性别">
                                        <el-radio-group v-model="addForm.sex">
                                            <el-radio :label="1">男</el-radio>
                                            <el-radio :label="0">女</el-radio>
                                        </el-radio-group>
                                    </el-form-item>
                                    <el-form-item label="开始时间">
                                        <el-date-picker v-model="addForm.startCallTime" type="datetime" placeholder="选择开始通话时间" :picker-options="pickerOptions">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="结束时间">
                                        <el-date-picker v-model="addForm.endCallTime" type="datetime" placeholder="选择结束通话时间" :picker-options="pickerOptions">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="挂断位置">
                                        <el-select v-model="addForm.hangUpPosition" placeholder="请选择挂断位置" clearable>
                                            <el-option v-for="item in hangup" :label="item.name" :value="item.code"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <!-- <el-form-item label="标签重复">
                                        <el-radio-group v-model="addForm.isRepeate">
                                            <el-radio :label="0">是</el-radio>
                                            <el-radio :label="1">否</el-radio>
                                        </el-radio-group>
                                    </el-form-item> -->
                                    <el-form-item label="备注">
                                        <el-input type="textarea" v-model="addForm.remark"></el-input>
                                    </el-form-item>
                                    <el-form-item label="是否跟踪">
                                        <el-select v-model="addForm.followStatus" clearable>
                                            <el-option v-for="item in followStatu" :label="item.name" :value="item.code"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="跟踪日期" v-show="!addForm.followStatus">
                                        <el-date-picker v-model="addForm.followDate" type="date" placeholder="选择跟踪日期" :picker-options="pickerOptions">
                                        </el-date-picker>
                                    </el-form-item>
                                </el-form>
                                <div slot="footer" class="dialog-footer">
                                    <el-button @click="dialogAddForm = false">取 消</el-button>
                                    <el-button type="primary" @click="onAddSubmit" :loading="editLoading">提交</el-button>
                                </div>
                            </el-dialog>
                            <!--退出按钮页面-->
                            <el-dialog title="提示" v-model="dialogQuit" size="tiny" v-cloak>
                              <span>确认退出吗？</span>
                              <span slot="footer" class="dialog-footer">
                                <el-button @click="dialogQuit = false">取 消</el-button>
                                <el-button type="primary" @click="surequit">确 定</el-button>
                              </span>
                            </el-dialog>
                            <!--查询按钮查询所有记录页面-->
                            <el-dialog title="历史记录清单" v-model="callRecordDialog">
                              <el-table :data="callRecordAll" border highlight-current-row>
                                 <el-table-column prop="id" align="center" label="标签ID"></el-table-column>
                                 <el-table-column prop="name" align="center" label="姓氏"></el-table-column>
                                 <el-table-column prop="sex" align="center" label="性别" :formatter="changeSex"></el-table-column>
                                 <!-- <el-table-column prop="customerTag" label="标签"></el-table-column> -->
                                 <el-table-column width="120" prop="mobile" align="center" label="手机号码"></el-table-column>
                                 <el-table-column align="center" prop="customerServerNickName" label="客服昵称"></el-table-column>
                                 <el-table-column align="center" prop="callResult" label="呼叫结果" :formatter="changecallResult"></el-table-column>
                                 <el-table-column prop="hangUpPosition" align="center" label="挂断位置" :formatter="changeHangUpPosition"></el-table-column>
                                <el-table-column prop="startCallTime" align="center" label="开始通话时间"  :formatter="changeStartCallTime"></el-table-column>
                                <el-table-column prop="endCallTime" align="center" label="结束通话时间"  :formatter="changeEndCallTime"></el-table-column>
                                 <!-- <el-table-column align="center" prop="isRepeate" label="标签是否重复" :formatter="changeRepeat"></el-table-column> -->
                                 <el-table-column prop="followStatus" align="center" label="跟进状态" :formatter="changeIsFollow"></el-table-column>
                                 <el-table-column align="center" prop="followDay" label="跟进天数"></el-table-column>
                                 <el-table-column prop="remark" align="center" label="备注"></el-table-column>
                                  <el-table-column align="center" width="60" label="操作">
                                      <template scope="scope">
                                          <i class="el-icon-edit comIcon" @click="historyEdit(scope.$index, scope.row)" title="编辑"></i>
                                      </template>
                                  </el-table-column>  
                              </el-table>
                            </el-dialog>
                    </el-col>
                </div>
            </section>
        </el-col>
    </el-row>
    
</div>
</body>
<script>
    /*"use strict";*/
    new Vue({
        el: '#app',
        data: {
            fullscreenLoading:false,//页面数据加载时，出现加载动画
            flag:true, //控制子单据某些字段的隐藏
            hangup:[],//存放挂断位置的数据
            callResult:[],//存放接听结果
            followStatu:[],//存放跟踪状态
            callresult:'',//接听结果
            begintime:'',//开始时间
            endtime:'',//结束时间
            repeatTimes:'',//重复次数
            customername:'',//客户姓名
            followday:'',//跟进天数
            calltime:'',//通话时间
            serverName:'',//客服昵称
            batchData: '',//选择批次数据
            options: [],//下拉列表展示几批信息
            addForm: {
                /*"customerTagId":'',    //客户标签id
                "mobile":'',           //客户电话
                "callResult":'',            //是否接听
                "remark":'',             //备注
                "hangUpPosition":'',      //挂断位置
                "customerServerId":'',   //客服id
                "followStatus":'',       //跟进状态
                "followDay":'',          //跟进天数
                "followDate":'',          //跟进日期
                "startCallTime":'',       //开始通话时间
                "endCallTime":'',         //结束通话时间
                "virtualMobile":'',       //虚拟电话
                "sex":-1,               //性别
                "name":'',             //姓氏
                "isRepeate":-1             //标签是否重复*/
            },
            callRecordAll:[
            /*拨打记录*/
            ],
            lastCallRecord:{},//最后一次拨打记录/**/
            dialogQuit:false,
            editLoading: false,//编辑最后一次拨打记录对话框显示与否
            lastCallRecordDialog:false,//最后一次拨打记录的对话框显示与否
            callRecordDialog:false,//所有拨打记录的对话框显示与否
            multipleSelection: [],
            currentPage: 1,//当前所在的页数
            totalPage:0,//总条数
            pageSize:2,//每页展示几条
            batchTableData: [],//批次的数据
            dialogFormVisible: false,
            dialogEditForm: false,
            dialogAddForm: false,
            editForm: {
                name:'',
                id :'',
                mobile:'',
                sex :'',
                customerTag:'',
                callResult :'',
                hangUpPosition :'',
                /*isRepeate :'',*/
                startCallTime :'',
                lastCustomerServerNickName:'',
                endCallTime:'',
                remark:'',
                lastOperateTime:'',
                dialTime :'',
                followStatus:'',
                followDate :''
            },
            pickerOptions: {
                //过滤跟踪时间不低于今天
                disabledDate(time) {
                    return time.getTime() < Date.now() - 8.64e7;
                }
            }
        },
        mounted:function(){
            this.getBatch();
        },
        methods: {
            changeOption: function (val) {
                // console.log(val);
                //初始化数据
                this.currentPage=1;
                this.customername='';
                this.serverName='';
                this.callresult='';
                this.begintime='';
                this.endtime='';
                this.repeatTimes='';
                this.followday='';
                this.calltime='';
                this.batchData = val;
                this.getBatchDate();
            },
            getBatch:function(){
                //获取批次
                var _this=this;
               axios.get('/keyValue/items/hangupPosition_sex_isRepeate_followStatus_callResult').then(function (response) {
                   //console.log(response.data);
                   _this.hangup=cyclic(response.data[0].keyValueItems);//挂断位置
                   _this.callResult=cyclic(response.data[4].keyValueItems);//呼叫结果
                    _this.followStatu=cyclic(response.data[3].keyValueItems);//将字典项中的跟踪状态赋给vue中的followStatus
                  // console.log(dictionary)
                 }).catch(function (error) {
                   console.log(error);
                 });
                axios.get('/customerInfo/batch').then(function (response) {
                   /* console.log(response);*/
                    //console.log(response.data);
                    _this.options=response.data;
                  }).catch(function (error) {
                    console.log(error);
                  });
            },
            getBatchDate:function(){
                //通过选择批次后，获取主表的数据
                var _this=this;
                this.fullscreenLoading=true;
                //console.log(this.batchData);
                this.batchTableData=[];
                
                    axios.get('/customerInfo/callRecord/'+this.batchData+'/'+this.currentPage+'/'+this.pageSize).then(function (response) {
                        console.log(response.data);
                        _this.fullscreenLoading=false;
                        var data=response.data;
                        _this.batchTableData=data.customerTags;
                        _this.totalPage=data.totalItemCount;
                        //console.log(_this.batchTableData)
                      }).catch(function (error) {
                        console.log(error);
                      });
              
            },
            searchGetData:function(){
                //筛选，过滤操作。查询出的数据
                    var searchCondition={};
                    var _this=this;
                    this.batchTableData=[];
                    this.totalPage=0;
                    searchCondition.importBatch= this.batchData;  //导入批次
                    searchCondition.pageNo  = this.currentPage;      //第几页
                    searchCondition.itemCount= this.pageSize;    //每页条数
                    searchCondition.name= this.customername;      //名称
                    searchCondition.customerServerNickName=this.serverName; //客服昵称
                    searchCondition.callResult= this.callresult;     //通话结果
                    searchCondition.dialTime=  this.repeatTimes;      //通话次数
                    searchCondition.followDay= this.followday;     //跟进天数
                    searchCondition.callTime=  this.calltime;    //通话长度
                    searchCondition.startDate= this.begintime;      //开始时间
                    searchCondition.endDate=this.endtime;  //结束时间
                    this.fullscreenLoading=true;
                if(this.batchData==''){
                    this.$message('请先选择批次');
                    _this.fullscreenLoading=false;
                }else{ 
                    //console.log(searchCondition)
                    axios.post('/customerInfo/condition',searchCondition).then(function (response) {
                        //console.log(response.data);
                        var data=response.data;
                        _this.fullscreenLoading=false;
                        if(data){
                            _this.batchTableData=data.customerTags;
                            _this.totalPage=data.totalItemCount;
                        }
                        
                        //console.log(_this.batchTableData)
                      }).catch(function (error) {
                        console.log(error);
                      });    
                }
            },
            exportData:function(){
                //导出按钮导出数据
                    var exportCondition={};
                    var _this=this;
                    /*this.batchTableData=[];
                    this.totalPage=0;*/
                    exportCondition.importBatch= this.batchData;  //导入批次
                    exportCondition.name= this.customername;      //名称
                    exportCondition.customerServerNickName=this.serverName; //客服昵称
                    exportCondition.callResult= this.callresult;     //通话结果
                    exportCondition.dialTime=  this.repeatTimes;      //通话次数
                    exportCondition.followDay= this.followday;     //跟进天数
                    exportCondition.callTime=  this.calltime;    //通话长度
                    exportCondition.startDate= this.begintime;      //开始时间
                    exportCondition.endDate=this.endtime;  //结束时间
                if(this.batchData==''){
                    this.$message('请先选择批次');
                }else{ 
                    axios.get('/customerInfo/excel',{params:exportCondition}).then(function (response) {
                        window.location.href=response.request.responseURL;
                      }).catch(function (error) {
                        console.log(error);
                      }); 
                     /* axios({
                        method: 'get',
                        url: '/customerInfo/excel',
                        params: exportCondition,
                        headers: {'Content-Type': 'application/vnd.ms-excel;charset=utf-8'}
                      }); */  
                }

            },
            
            handleAdd: function (index, row) {
                //新增按钮,弹出对话框
                //console.log(row)
                this.addForm={
                    "customerTagId":'',    //客户标签id
                    "mobile":'',           //客户电话
                    "callResult":'',            //是否接听
                    "remark":'',             //备注
                    "hangUpPosition":'',      //挂断位置
                    "customerServerId":'',   //客服id
                    "followStatus":'',       //跟进状态
                    "followDay":'',          //跟进天数
                    "followDate":'',          //跟进日期
                    "startCallTime":'',       //开始通话时间
                    "endCallTime":'',         //结束通话时间
                    "virtualMobile":'',       //虚拟电话
                    "sex":-1,               //性别
                    "name":'',             //姓氏
                    "isRepeate":-1             //标签是否重复
                }
                this.dialogAddForm = true;
                this.addForm.name = row.name;
                this.addForm.sex = row.sex;
                this.addForm.mobile = row.mobile;
                this.addForm.isRepeate = row.isRepeate;
                this.addForm.customerTagId = row.id;
                //this.addForm.followStatus=row.followStatus;
                //console.log(this.addForm)
            },
            onAddSubmit: function () {
                //新增对话框，修改完成-提交
                this.addForm.customerServerId = customerId;//此时的customerId是coojs中的customerId
                //console.log(this.addForm);
                this.fullscreenLoading=true;
                var _this=this;
                axios.post('/customerInfo/callRecord',this.addForm).then(function (response) {
                    //console.log(response.data);
                    _this.dialogAddForm = false;
                    _this.fullscreenLoading=false;
                    _this.$message({
                      message: '提交成功',
                      type: 'success'
                    });
                    //新增通话记录，提交完成后，重新获取一下数据
                    _this.getBatchDate();
                  }).catch(function (error) {
                    console.log(error);
                  });///**/
                
            },
            handleEdit: function (index, row) {
                //编辑按钮
                //console.log(row)
                this.flag=true;
                this.dialogEditForm = true;
                this.editForm.id=row.lastCallRecordId;
                this.editForm.name = row.name;
                this.editForm.customerTagId = row.id;
                this.editForm.mobile = row.mobile;
                this.editForm.sex = row.sex;
                this.editForm.customerTag = row.customerTag;
                /*this.editForm.callResult = row.callResult;
                this.editForm.hangUpPosition = row.hangUpPosition;
                this.editForm.followStatus = row.followStatus;*/
                for(i=0;i<this.callResult.length;i++){
                    //此for遍历是为了在点击编辑按钮时候，删除的状态不在在下拉列表显示
                    if(row.callResult==this.callResult[i].code){
                        this.editForm.callResult = row.callResult;
                        break;
                    }else{
                        this.editForm.callResult = "";
                    }
                }
                for(i=0;i<this.hangup.length;i++){
                    //此for遍历是为了在点击编辑按钮时候，删除的状态不在在下拉列表显示
                    if(row.hangUpPosition==this.hangup[i].code){
                        this.editForm.hangUpPosition = row.hangUpPosition;
                        break;
                    }else{
                        this.editForm.hangUpPosition = "";
                    }
                }
                for(i=0;i<this.followStatu.length;i++){
                    //此for遍历是为了在点击编辑按钮时候，删除的状态不在在下拉列表显示
                    if(row.followStatus==this.followStatu[i].code){
                        this.editForm.followStatus = row.followStatus;
                        break;
                    }else{
                        this.editForm.followStatus = "";
                    }
                }
                /*this.editForm.isRepeate = row.isRepeate;*/
                if(row.startCallTime){
                    this.editForm.startCallTime = new Date(row.startCallTime);
                }else{
                    this.editForm.startCallTime = row.startCallTime;
                }
                if(row.endCallTime){
                    this.editForm.endCallTime = new Date(row.endCallTime);
                }else{
                    this.editForm.endCallTime = row.endCallTime;
                }
                this.editForm.lastCustomerServerNickName = row.lastCustomerServerNickName;
                
                this.editForm.remark = row.remark;
                this.editForm.lastOperateTime = row.lastOperateTime;
                this.editForm.dialTime = row.dialTime;
                
                
                this.editForm.followDate = row.followDate;
                //this.deepCopy(row.callRecords[0],this.editForm)
                //console.log(this.editForm)
            },
            changeFollowstatus:function(val){
                //console.log(val);
                if(val!=0){
                    this.editForm.followDate="";
                    //console.log(this.editForm.followDate)
                }
            },
            onEditSubmit:function(){
                var _this=this;
                /*console.log(this.editForm);*/
                var editForm01={};
                editForm01.id=this.editForm.id;
                editForm01.customerTagId=this.editForm.customerTagId;
                editForm01.mobile=this.editForm.mobile;
                editForm01.callResult=this.editForm.callResult;
                editForm01.remark=this.editForm.remark;
                editForm01.hangUpPosition=this.editForm.hangUpPosition;
                editForm01.followStatus=this.editForm.followStatus;
                editForm01.followDate=this.editForm.followDate || '';
                editForm01.startCallTime=this.editForm.startCallTime;
                editForm01.endCallTime=this.editForm.endCallTime;
                editForm01.sex=this.editForm.sex;
                editForm01.name=this.editForm.name;
                this.fullscreenLoading=true;
                axios.put('/customerInfo/callRecord',editForm01).then(function (response) {
                    _this.fullscreenLoading=false;
                    console.log(_this.callRecordAll);
                    _this.callRecordDialog=false;
                    _this.dialogEditForm = false;
                    _this.$message({
                      message: '修改成功',
                      type: 'success'
                    });
                    _this.getBatchDate();
                  }).catch(function (error) {
                    console.log(error);
                  });/**/
            },
            checkAll:function(index, row){
                /*查看拨打记录*/
                this.callRecordDialog=true;
                /*console.log(row)
                console.log(row.callRecords)*/
                this.callRecordAll=row.callRecords;
                /*this.callRecordAll.isRepeate=row.isRepeate;*/
                console.log(this.callRecordAll)
            },
            historyEdit:function(index,row){
                //查询过历史记录后，可以对历史记录编辑
                //console.log(row)
                this.flag=false;
                this.dialogEditForm = true;
                //this.editForm = row;
                this.editForm.id=row.id;
                this.editForm.name = row.name;
                this.editForm.customerTagId = row.customerTagId;
                this.editForm.mobile = row.mobile;
                this.editForm.sex = row.sex;
                this.editForm.customerTag = row.customerTag;
                /*this.editForm.callResult = row.callResult;
                this.editForm.hangUpPosition = row.hangUpPosition;*/
                this.editForm.isRepeate = row.isRepeate;
                this.editForm.startCallTime = new Date(row.startCallTime);
                this.editForm.lastCustomerServerNickName = row.customerServerNickName;
                this.editForm.endCallTime = new Date(row.endCallTime);
                this.editForm.remark = row.remark;
                this.editForm.lastOperateTime =new Date( row.createTime).format('yyyy-MM-dd hh:mm:ss');
                this.editForm.dialTime = row.dialTime;
                /*this.editForm.followStatus = row.followStatus;*/
                this.editForm.followDate = row.followDate;
                for(i=0;i<this.callResult.length;i++){
                    //此for遍历是为了在点击编辑按钮时候，删除的状态不在在下拉列表显示
                    if(row.callResult==this.callResult[i].code){
                        this.editForm.callResult = row.callResult;
                        break;
                    }else{
                        this.editForm.callResult = "";
                    }
                }
                for(i=0;i<this.hangup.length;i++){
                    //此for遍历是为了在点击编辑按钮时候，删除的状态不在在下拉列表显示
                    if(row.hangUpPosition==this.hangup[i].code){
                        this.editForm.hangUpPosition = row.hangUpPosition;
                        break;
                    }else{
                        this.editForm.hangUpPosition = "";
                    }
                }
                for(i=0;i<this.followStatu.length;i++){
                    //此for遍历是为了在点击编辑按钮时候，删除的状态不在在下拉列表显示
                    if(row.followStatus==this.followStatu[i].code){
                        this.editForm.followStatus = row.followStatus;
                        break;
                    }else{
                        this.editForm.followStatus = "";
                    }
                }
                //console.log(this.editForm)
            },
            handleSizeChange: function (val) {
                /*console.log(val)*/
                this.currentPage=1;
                this.pageSize=val;
                this.getBatchDate();
            },
            handleCurrentChange: function (val) {
                //当前页改变时候触发
                this.currentPage = val;
                var _this=this;
                this.fullscreenLoading=true;
                axios.get('/customerInfo/callRecord/'+this.batchData+'/'+this.currentPage+'/'+this.pageSize).then(function (response) {
                    //console.log(response.data);
                    _this.fullscreenLoading=false;
                    _this.totalPage=response.data.totalItemCount;
                    _this.batchTableData=response.data.customerTags;
                    //_this.pageSize=response.data.totalPageNo;
                    //console.log(_this.pageSize)
                  }).catch(function (error) {
                    console.log(error);
                  });
            },
            unbind: function () {
                alert('解除绑定')
            },
            quit:function(){
              //退出按钮
                this.dialogQuit=true;
            },
            surequit:function(){
                this.dialogQuit = false;
                window.location="login.html"
            },
            checkHistory:function(){
            	alert("查询历史拨打记录")
            },
            changeStartCallTime:function(row,column){//将开始通话时间戳改为标准时间
                if(row.startCallTime){
                    return row.startCallTime=new Date( row.startCallTime).format('yyyy-MM-dd hh:mm:ss');
                }
                
            },
            changeEndCallTime:function(row,column){//将结束通话时间戳改为标准时间
                if(row.endCallTime){
                    return row.endCallTime=new Date( row.endCallTime).format('yyyy-MM-dd hh:mm:ss');
                }
            },
            changeSex:function(row,column){//字典项修改性别
                return changeVal(row.sex,'sex')
            },/**/
            changeLastTime:function(row,column){//将时间戳改为标准时间
                if(row.lastOperateTime){
                    return row.lastOperateTime=new Date( row.lastOperateTime).format('yyyy-MM-dd hh:mm:ss');
                }
            },
            changeRepeat:function(row,column){//字典项标签是否重复
                return changeVal(row.isRepeate,'isRepeate')
            },
            changeHangUpPosition:function(row,column){//字典项标签挂断位置
                return changeVal(row.hangUpPosition,'hangUpPosition')
            },
            changeIsFollow:function(row,column){//字典项标签是否跟踪
                return changeVal(row.followStatus,'followStatus')
            },
            changecallResult:function(row,column){//字典项标签接听结果
                return changeVal(row.callResult,'callResult')
            },
            deepCopy:function(obj1,obj2){
                if(typeof obj1 != 'object'){
                    return obj1;
                }
                for(attr in obj1){
                    obj2[attr]=this.deepCopy(obj1[attr]);
                }
                return obj2;
            },

        }
    })
</script>
</html>